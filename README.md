# AD-Onboarding-Helper
# AD Onboarding Helper

Минималистичный Python-GUI инструмент для автоматического создания новых пользователей в Active Directory
по данным из заявки (формы HR/руководителя).

Скрипт:

- парсит текст заявки в свободном порядке пунктов,
- генерирует логин по ГОСТ-транслитерации,
- создаёт пользователя сразу в **двух доменах**:
  - `pak-cspmz.ru`
  - `omg.cspfmba.ru`
- заполняет ключевые атрибуты в AD (должность, отдел, адрес, телефоны, руководитель и т.п.),
- задаёт пароль по умолчанию из GUI (хранится в зашифрованном виде, передаётся в AD как SecureString),
- ведёт подробный лог и умеет работать в режиме **DRY RUN** (без фактического создания пользователей).

---

## 1. Структура проекта

Основной файл:

- `ad_onboarding_gui.py` — Python-скрипт с GUI на Tkinter и логикой генерации команд PowerShell.

Внутри скрипта:

- **DOMAIN_CONFIGS** — конфигурация доменов (имена контроллеров, OU, UPN-суффиксы, доменные e-mail).
- **ADDRESS_DETAILS** — словарь с шаблонами адресов (Щукинская / Погодинская).
- Функции для:
  - парсинга заявки,
  - транслитерации ФИО и генерации логина,
  - нормализации телефона,
  - построения команд `New-ADUser` и `Set-ADUser`,
  - запуска PowerShell и логирования.

---

## 2. Требования

### Среда

- Windows 10/11 или Windows Server (тот же домен, что и AD).
- Установлен Python 3.9+.
- Права учётки, от которой запускается скрипт:
  - право создавать пользователей в нужных OU обоих доменов,
  - право читать пользователей (для поиска дубликатов и руководителей).

### AD / PowerShell

- RSAT / Active Directory module для PowerShell (`Import-Module ActiveDirectory` должен работать).
- Наличие исполняемого `powershell.exe` в `PATH`.
- Доступ к доменам/контроллерам:
  - `dc03.pak-cspmz.ru`
  - `DC22.omg.cspfmba.ru`
  - для поиска руководителей по всему лесу `cspfmba.ru` (GC).

---

## 3. Логика работы

### 3.1. Входные данные

На вход подаётся **текст заявки**, например:

```text
1) Фамилия : Сандальный
2) Имя : Роман 
3) Отчество : Семёныч
4) Есть ли у вас фотография сотрудника? : Нет
5) Руководитель : Нормальный Аркадий
6) Управление : управление организации и проведения исследований
7) Отдел : управление организации и проведения исследований/отдел анализа и прогнозирования медико-биологических рисков здоровью
8) Должность сотрудника : Аналитик
9) Дата выхода сотрудника : 10-12-2025
10) Режим работы сотрудника : Гибридный
11) Номер кабинета : 315 стр.5
12) Предоставить электронный почтовый ящик для сотрудника : Да
13) Предоставить внутренний телефонный номер для сотрудника : Да
14) Номер сотового телефона для переадресации : +7(903)999-99-99
15) Оборудование необходимое сотруднику : ...
16) Операционная система для ноутбука в офисе : Windows 10 pro
17) Предоставить доступ к серверам : Нет
18) Предоставить доступ к папкам : Нет
19) Примечание :
Важно: порядок пунктов в форме может быть любым — скрипт ищет поля по названию (“Фамилия”, “Имя”, “Руководитель” и т.д.), а не по номеру.

3.2. Генерация логина (sAMAccountName)

Логин строится по правилам:

Берётся первая буква имени + фамилия.

ФИО транслитерируется по ГОСТ Р 7.0.34-2014
(а→a, б→b, в→v, …, щ→shch, ъ/ь пропускаются, ю→yu, я→ya).

Пример: Каширский Антон → akashirskiy.

Если такой логин уже существует в любом из доменов:

пробуется две буквы имени (ankashirskiy),

затем добавляются числовые суффиксы (akashirskiy2, akashirskiy3, …) до нахождения свободного варианта.

Проверка выполняется через Get-ADUser -Filter "SamAccountName -eq 'xxx'" по каждому домену из DOMAIN_CONFIGS.

3.3. Нормализация мобильного телефона

Телефон из заявки приводится к формату:

убираются все символы, кроме цифр,

+7XXXXXXXXXX → 8XXXXXXXXXX,

7XXXXXXXXXX → 8XXXXXXXXXX,

XXXXXXXXXX (10 цифр) → 8XXXXXXXXXX.

Пример:
+7(917)561-44-55 → 89175614455.

3.4. Заполнение атрибутов в AD

Общие атрибуты:

Name — ФИО (используется как CN).

GivenName — имя.

Surname — фамилия.

SamAccountName — логин (сгенерированный).

UserPrincipalName — логин + доменный UPN-суффикс.

DisplayName — ФИО.

Title — должность (в нижнем регистре).

Department — отдел/управление (последний сегмент после /, в нижнем регистре).

Company — ФГБУ «ЦСП» ФМБА России.

Office — номер кабинета.

EmailAddress — sAMAccountName@cspfmba.ru (если в заявке «почта: Да»).

Description — дублирует должность в нижнем регистре.

Адрес:

streetAddress — строка адреса (Щукинская / Погодинская),

postOfficeBox (postOfficeBox) — Москва,

l (City) — Москва,

st (State) — Москва,

postalCode — 123182 или 119121,

c (Country) — RU.

Доменные особенности

pak-cspmz.ru

Создание в OU: OU=omg,OU=csp,OU=Users,OU=csp,DC=pak-cspmz,DC=ru.

mobile заполняется нормализованным мобильным телефоном.

manager ищется и задаётся только в этом домене.

omg.cspfmba.ru

Создание в OU: OU=Institute of Synthetic Biology and Genetic Engineering,DC=omg,DC=cspfmba,DC=ru.

Особые атрибуты:

division — "институт синтетической биологии и генной инженерии";

section — если сотрудник работает в одном из управлений:

управление организации и проведения исследований,

управление цифровых систем и биоинформатики,

управление экспериментальной биотехнологии и генной инженерии,
то в section записывается соответствующий отдел/лаборатория/виварий
(последний сегмент строки “Отдел” после /, укороченный до 32 символов).

otpMobile — нормализованный мобильный телефон.

Поле mobile не заполняется (только otpMobile).

Установка руководителя (manager)

Для pak-доменa:

Get-ADUser -Server dc03.pak-cspmz.ru -Filter "DisplayName -like '*ФИО*'".

При нахождении — Set-ADUser -Manager <DN руководителя>.

Для omg.cspfmba.ru:

Поиск руководителя в самом домене omg.cspfmba.ru.

Если не найден — поиск во всём лесу cspfmba.ru (аналог выбора «Весь каталог» в оснастке).

Если найден — Set-ADUser -Manager <DN>.

Если руководитель нигде не найден — manager не устанавливается, в лог пишется пояснение.

4. GUI и сценарий использования

Запустить python ad_onboarding_gui.py от доменной учётки с нужными правами.

В текстовое поле вставить тело заявки (как прислал HR/руководитель).

Выбрать адрес офиса:

ул. Щукинская, дом 5, стр.5

ул. Погодинская, д. 10, стр.2

Отметить галочками, в каких доменах нужно создать пользователя:

[x] Создавать в pak-cspmz

[x] Создавать в omg.cspfmba

При необходимости оставить DRY RUN включённым — это режим проверки без фактического создания.

Нажать кнопку «Разобрать и создать».

Проверить лог:

разобранные данные (ФИО, логин, отдел, телефоны, адрес),

предпросмотр UPN/e-mail/атрибутов по доменам,

результаты выполнения New-ADUser/Set-ADUser с пояснениями.

Если DRY RUN выключен — перед созданием появится диалог-подтверждение.

5. Безопасность и ограничения

Скрипт не хранит пароли и не выполняет интерактивную аутентификацию — используется контекст текущей учётки.

Все изменения в AD происходят строго в указанных OU доменов, прописанных в DOMAIN_CONFIGS.

Ответственность за запуск — на администраторе, запускающем скрипт. Рекомендуется:

сначала тестировать в DRY RUN,

при изменении логики — проверять на тестовых OU / тестовом домене.

6. Доработки и идеи на будущее

Автоматическая генерация стартового пароля и выдача его в лог / отдельный файл.

Автоматическое включение пользователя в стандартные группы безопасности/доступа.

Валидация формы (обязательные поля) до создания пользователя.

Локализация GUI/логов (RU/EN переключатель).

Обёртка в виде exe через PyInstaller для удобного развёртывания на рабочих местах администраторов.
